<input type="file" #fileInput (change)="onBankTrxFileSelected($event)" style="display: none;" />
<div class="container">
    <form #f="ngForm" (ngSubmit)="submit(f)">
        <div class="row" *ngIf="!bankTransactions || bankTransactions.length < 1">
            <button type="button" class="btn btn-primary" (click)="fileInput.click()">Upload bank transactions</button>
        </div>
        <div class="row" *ngIf="bankTransactions && bankTransactions.length > 0">
            <div class="col">
                <button type="button" class="btn btn-primary" (click)="clearTransactions()">Clear Transactions</button>
            </div>
        </div>
        <div class="row" *ngIf="bankTransactions && bankTransactions.length > 0">
            <div class="col-md-9">
                <table class="table table-bordered table-low-margin table-selectable">
                    <thead>
                        <tr>
                            <th data-field="Reference">Reference</th>
                            <th data-field="Amount">Amount</th>
                            <th data-field="Description">Description</th>
                            <th data-field="Date">Date</th>
                            <th data-field="Account">Account</th>
                            <th data-field="TrxType">Transaction Type</th>
                            <th data-field="TrxType">Pending</th>
                            <th data-field="Status">Status</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr *ngFor="let item of bankTransactions; let i = index" (click)="selectRow(i)"
                            [class.selected]="selectedRowIndex === i" class=" table-selectable">
                            <td>{{item.current.fileTransaction.transactionId}}</td>
                            <td>{{item.current.fileTransaction.originalAmount | currencyAmount:
                                item.current.currency.symbol}}</td>
                            <td>{{item.current.fileTransaction.description}}</td>
                            <td>{{item.current.fileTransaction.transactionDate | date:"yyyy/MM/dd"}}</td>
                            <td>
                                <div *ngIf="item.current.dbStatus !== BankTransactionStatus.Ignored">
                                    <select [(ngModel)]="item.current.singleTrxAccountId" class="form-select"
                                        [name]="'singleAcc[' + i + ']'"
                                        [disabled]="item.current.dbStatus === BankTransactionStatus.Processed" required>
                                        <option [ngValue]="null">Select an account</option>
                                        <option *ngFor="let item of item.accounts" [value]="item.id">
                                            {{item.name}}</option>
                                    </select>
                                </div>

                                <div *ngIf="item.current.dbStatus === BankTransactionStatus.Ignored">
                                    <span>--</span>
                                </div>
                            </td>
                            <td>
                                <div *ngIf="item.current.dbStatus !== BankTransactionStatus.Ignored">
                                    <select [(ngModel)]="item.current.singleTrxTypeId" class="form-select"
                                        [name]="'trxType[' + i + ']'" required>
                                        <option [ngValue]="null">Select a type</option>
                                        <option *ngFor="let item of transactionTypes" [value]="item.id">
                                            {{item.name}}</option>
                                    </select>
                                </div>

                                <div *ngIf="item.current.dbStatus === BankTransactionStatus.Ignored">
                                    <span>--</span>
                                </div>
                            </td>
                            <td>
                                <div class="form-check" *ngIf="item.current.dbStatus !== BankTransactionStatus.Ignored">
                                    <input mdbCheckbox ngModel [name]="'is-pending[' + i + ']'" class="form-check-input"
                                        type="checkbox" [(ngModel)]="item.current.singleTrxIsPending"
                                        [disabled]="item.current.dbStatus === BankTransactionStatus.Processed" />
                                </div>
                                <div *ngIf="item.current.dbStatus === BankTransactionStatus.Ignored">
                                    <span>--</span>
                                </div>
                            </td>
                            <td>{{getStatusName(item.current.dbStatus)}}</td>
                        </tr>
                    </tbody>
                </table>
            </div>
            <div class="col-md-3" *ngIf="selectedTransaction">
                <form #f="ngForm" (ngSubmit)="submit(f)">
                    <div class="row">
                        <div class="col">
                            <ul>
                                <li><strong>Reference:</strong>
                                    {{selectedTransaction.current.fileTransaction.transactionId}}</li>
                                <li><strong>Total amount:</strong>
                                    {{selectedTransaction.current.fileTransaction.originalAmount |
                                    currencyAmount:
                                    selectedTransaction.current.currency.symbol}}</li>
                            </ul>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col">
                            <div class="form-group">
                                <input [(ngModel)]="selectedTransaction.current.fileTransaction.description" type="text"
                                    name="description" class="basic-input form-control" required />
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col">
                            <div class="basic-input form-control">
                                <div class="form-check">
                                    <input mdbCheckbox ngModel name="ignoreSelected" class="form-check-input"
                                        type="checkbox" id="ignore-selected" [(ngModel)]="ignoreSelected"
                                        [disabled]="selectedTransaction.current.dbStatus !== BankTransactionStatus.Inserted" />
                                    <label class="form-check-label" for="ignore-selected">
                                        Ignore
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row" *ngIf="selectedTransaction.current.dbStatus !== BankTransactionStatus.Inserted">
                        <div class="col">
                            <button type="button" class="btn btn-outline-warning btn-block"
                                (click)="requestReset()">Reset</button>
                        </div>
                    </div>
                    <!-- <div class="row">
                        <div class="col">
                            <div class="basic-input form-control">
                                <div class="form-check">
                                    <input mdbCheckbox [(ngModel)]="isMultipleTrx" name="multipleTransactions"
                                        class="form-check-input" type="checkbox" id="multiple-transactions"
                                        [disabled]="ignoreSelected" />
                                    <label class="form-check-label" for="multiple-transactions">
                                        Multiple transactions
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div> -->
                    <!-- <div class="row">
                        <div class="col" *ngIf="selectedTransaction?.current?.processData?.transactions">
                            <div class="row"
                                *ngFor="let trxItem of selectedTransaction?.current?.processData?.transactions">
                                <div class="col-md-4">
                                    <input type="number" [name]="'amount-' + trxItem.spendId"
                                        [(ngModel)]="trxItem.originalAmount">
                                </div>
                                <div class="col-md-4">

                                </div>
                                <div class="col-md-4">

                                </div>
                            </div>
                        </div>
                    </div> -->
                </form>
            </div>
        </div>
        <div class="row">
            <div class="col-md-9">
                <input *ngIf="bankTransactions && bankTransactions.length > 0 && anyNew" type="submit" value="Submit"
                    class="btn btn-primary" style="float: right;" [disabled]="f.invalid">
            </div>
        </div>
    </form>
</div>